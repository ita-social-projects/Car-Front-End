"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _synchronousPromise = require("synchronous-promise");

var _Cancel = _interopRequireDefault(require("./cancel/Cancel"));

var _CancelToken = _interopRequireDefault(require("./cancel/CancelToken"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/** a FIFO queue of pending request */
var _pending_requests = [];

var _newReq = function _newReq() {
  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var actualConfig = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (typeof config === 'string') {
    // Allow for axios('example/url'[, config])
    actualConfig.url = config;
    config = actualConfig;
  }

  var method = config.method || "get";
  var url = config.url;
  var data = config.data;

  var promise = _synchronousPromise.SynchronousPromise.unresolved();

  if (config.cancelToken) {
    config.cancelToken.promise.then(function (cancel) {
      // check if promise is still waiting for an answer
      if (_pending_requests.find(function (x) {
        return x.promise === promise;
      })) {
        MockAxios.mockError(cancel, promise);
      }
    });
  }

  _pending_requests.push({
    config: config,
    data: data,
    method: method,
    promise: promise,
    url: url
  });

  return promise;
};

var _helperReq = function _helperReq(method, url, data, config) {
  var conf = data && config ? config : {};
  return _newReq(_objectSpread(_objectSpread({}, conf), {}, {
    data: data,
    method: method,
    url: url
  }));
};

var _helperReqNoData = function _helperReqNoData(method, url, config) {
  return _helperReq(method, url, {}, config);
};

var MockAxios = jest.fn(_newReq); // mocking Axios methods

MockAxios.get = jest.fn(_helperReqNoData.bind(null, "get"));
MockAxios.post = jest.fn(_helperReq.bind(null, "post"));
MockAxios.put = jest.fn(_helperReq.bind(null, "put"));
MockAxios.patch = jest.fn(_helperReq.bind(null, "patch"));
MockAxios["delete"] = jest.fn(_helperReqNoData.bind(null, "delete"));
MockAxios.request = jest.fn(_newReq);
MockAxios.all = jest.fn(function (values) {
  return Promise.all(values);
});
MockAxios.head = jest.fn(_helperReqNoData.bind(null, "head"));
MockAxios.options = jest.fn(_helperReqNoData.bind(null, "options"));
MockAxios.create = jest.fn(function () {
  return MockAxios;
});
MockAxios.interceptors = {
  request: {
    use: jest.fn(),
    eject: jest.fn()
  },
  response: {
    use: jest.fn(),
    eject: jest.fn()
  }
};
MockAxios.defaults = {
  headers: {
    common: []
  }
};

MockAxios.popPromise = function (promise) {
  if (promise) {
    // remove the promise from pending queue
    for (var ix = 0; ix < _pending_requests.length; ix++) {
      var req = _pending_requests[ix];

      if (req.promise === promise) {
        _pending_requests.splice(ix, 1);

        return req.promise;
      }
    }
  } else {
    // take the oldest promise
    var _req = _pending_requests.shift();

    return _req ? _req.promise : void 0;
  }
};

MockAxios.popRequest = function (request) {
  if (request) {
    var ix = _pending_requests.indexOf(request);

    if (ix === -1) {
      return void 0;
    }

    _pending_requests.splice(ix, 1);

    return request;
  } else {
    return _pending_requests.shift();
  }
};
/**
 * Removes an item form the queue, based on it's type
 * @param queueItem
 */


var popQueueItem = function popQueueItem() {
  var queueItem = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
  // first let's pretend the param is a queue item
  var request = MockAxios.popRequest(queueItem);

  if (request) {
    // IF the request was found
    // > set the promise
    return request.promise;
  } else {
    // ELSE maybe the `queueItem` is a promise (legacy mode)
    return MockAxios.popPromise(queueItem);
  }
};

MockAxios.mockResponse = function (response) {
  var queueItem = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var silentMode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  // replacing missing data with default values
  response = Object.assign({
    config: {},
    data: {},
    headers: {},
    status: 200,
    statusText: "OK"
  }, response);
  var promise = popQueueItem(queueItem);

  if (!promise && !silentMode) {
    throw new Error("No request to respond to!");
  } else if (!promise) {
    return;
  } // resolving the Promise with the given response data


  promise.resolve(response);
};

MockAxios.mockResponseFor = function (criteria, response) {
  var silentMode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

  if (typeof criteria === "string") {
    criteria = {
      url: criteria
    };
  }

  var queueItem = MockAxios.getReqMatching(criteria);

  if (!queueItem && !silentMode) {
    throw new Error("No request to respond to!");
  } else if (!queueItem) {
    return;
  }

  MockAxios.mockResponse(response, queueItem, silentMode);
};

MockAxios.mockError = function () {
  var error = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var queueItem = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var silentMode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  var promise = popQueueItem(queueItem);

  if (!promise && !silentMode) {
    throw new Error("No request to respond to!");
  } else if (!promise) {
    return;
  } // resolving the Promise with the given response data


  promise.reject(error);
};

MockAxios.lastReqGet = function () {
  return _pending_requests[_pending_requests.length - 1];
};

MockAxios.lastPromiseGet = function () {
  var req = MockAxios.lastReqGet();
  return req ? req.promise : void 0;
};

var _findReqByPredicate = function _findReqByPredicate(predicate) {
  return _pending_requests.slice().reverse() // reverse cloned array to return most recent req
  .find(predicate);
};

var _checkCriteria = function _checkCriteria(item, criteria) {
  if (criteria.method !== undefined && criteria.method.toLowerCase() !== item.method.toLowerCase()) {
    return false;
  }

  if (criteria.url !== undefined && criteria.url !== item.url) {
    return false;
  }

  return true;
};

MockAxios.getReqMatching = function (criteria) {
  return _findReqByPredicate(function (x) {
    return _checkCriteria(x, criteria);
  });
};

MockAxios.getReqByUrl = function (url) {
  return MockAxios.getReqMatching({
    url: url
  });
};

MockAxios.getReqByMatchUrl = function (url) {
  return _findReqByPredicate(function (x) {
    return url.test(x.url);
  });
};

MockAxios.queue = function () {
  return _pending_requests;
};

MockAxios.reset = function () {
  // remove all the requests
  _pending_requests.splice(0, _pending_requests.length); // resets all information stored in the mockFn.mock.calls and mockFn.mock.instances arrays


  MockAxios.get.mockClear();
  MockAxios.post.mockClear();
  MockAxios.put.mockClear();
  MockAxios.patch.mockClear();
  MockAxios["delete"].mockClear();
  MockAxios.head.mockClear();
  MockAxios.options.mockClear();
  MockAxios.request.mockClear();
  MockAxios.all.mockClear();
};

MockAxios.Cancel = _Cancel["default"];
MockAxios.CancelToken = _CancelToken["default"];

MockAxios.isCancel = function (u) {
  return !!(u && u.__CANCEL__);
}; // this is a singleton object


var _default = MockAxios;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2xpYi9tb2NrLWF4aW9zLnRzIl0sIm5hbWVzIjpbIl9wZW5kaW5nX3JlcXVlc3RzIiwiX25ld1JlcSIsImNvbmZpZyIsImFjdHVhbENvbmZpZyIsInVybCIsIm1ldGhvZCIsImRhdGEiLCJwcm9taXNlIiwiU3luY2hyb25vdXNQcm9taXNlIiwidW5yZXNvbHZlZCIsImNhbmNlbFRva2VuIiwidGhlbiIsImNhbmNlbCIsImZpbmQiLCJ4IiwiTW9ja0F4aW9zIiwibW9ja0Vycm9yIiwicHVzaCIsIl9oZWxwZXJSZXEiLCJjb25mIiwiX2hlbHBlclJlcU5vRGF0YSIsImplc3QiLCJmbiIsImdldCIsImJpbmQiLCJwb3N0IiwicHV0IiwicGF0Y2giLCJyZXF1ZXN0IiwiYWxsIiwidmFsdWVzIiwiUHJvbWlzZSIsImhlYWQiLCJvcHRpb25zIiwiY3JlYXRlIiwiaW50ZXJjZXB0b3JzIiwidXNlIiwiZWplY3QiLCJyZXNwb25zZSIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInBvcFByb21pc2UiLCJpeCIsImxlbmd0aCIsInJlcSIsInNwbGljZSIsInNoaWZ0IiwicG9wUmVxdWVzdCIsImluZGV4T2YiLCJwb3BRdWV1ZUl0ZW0iLCJxdWV1ZUl0ZW0iLCJtb2NrUmVzcG9uc2UiLCJzaWxlbnRNb2RlIiwiT2JqZWN0IiwiYXNzaWduIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsIkVycm9yIiwicmVzb2x2ZSIsIm1vY2tSZXNwb25zZUZvciIsImNyaXRlcmlhIiwiZ2V0UmVxTWF0Y2hpbmciLCJlcnJvciIsInJlamVjdCIsImxhc3RSZXFHZXQiLCJsYXN0UHJvbWlzZUdldCIsIl9maW5kUmVxQnlQcmVkaWNhdGUiLCJwcmVkaWNhdGUiLCJzbGljZSIsInJldmVyc2UiLCJfY2hlY2tDcml0ZXJpYSIsIml0ZW0iLCJ1bmRlZmluZWQiLCJ0b0xvd2VyQ2FzZSIsImdldFJlcUJ5VXJsIiwiZ2V0UmVxQnlNYXRjaFVybCIsInRlc3QiLCJxdWV1ZSIsInJlc2V0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QWxCO0FBQ0FqRSxFQUFBQSxTQUFTLENBQUNjLEdBQVYsQ0FBY21ELFNBQWQ7QUFDSCxDQWREOztBQWdCQWpFLFNBQVMsQ0FBQ2tFLE1BQVYsR0FBbUJBLGtCQUFuQjtBQUNBbEUsU0FBUyxDQUFDbUUsV0FBVixHQUF3QkEsdUJBQXhCOztBQUNBbkUsU0FBUyxDQUFDb0UsUUFBVixHQUFxQixVQUFDQyxDQUFELEVBQW9CO0FBQ3JDLFNBQU8sQ0FBQyxFQUFFQSxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsVUFBVCxDQUFSO0FBQ0gsQ0FGRCxDLENBSUE7OztlQUNldEUsUyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVHlwZVNjcmlwdCB2ZXJzaW9uIG9mIEF4aW9zIG1vY2sgZm9yIHVuaXQgdGVzdGluZyB3aXRoIFtKZXN0XShodHRwczovL2ZhY2Vib29rLmdpdGh1Yi5pby9qZXN0LykuXG4gKiBUaGlzIGZpbGUgaXMgYmFzZWQgb24gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vdHV4NC8zNjAwNmExODU5MzIzZjc3OWFiMFxuICpcbiAqIEBhdXRob3IgICBrbmVlLWNvbGEgPG5pa29sYS5kZXJlemljQGdtYWlsLmNvbT5cbiAqIEBsaWNlbnNlICBAbGljZW5zZSBNSVQgTGljZW5zZSwgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqL1xuXG5pbXBvcnQgeyBTeW5jaHJvbm91c1Byb21pc2UsIFVucmVzb2x2ZWRTeW5jaHJvbm91c1Byb21pc2UgfSBmcm9tIFwic3luY2hyb25vdXMtcHJvbWlzZVwiO1xuaW1wb3J0IENhbmNlbCBmcm9tIFwiLi9jYW5jZWwvQ2FuY2VsXCI7XG5pbXBvcnQgQ2FuY2VsVG9rZW4gZnJvbSBcIi4vY2FuY2VsL0NhbmNlbFRva2VuXCI7XG5pbXBvcnQge1xuICAgIEF4aW9zTW9ja1F1ZXVlSXRlbSxcbiAgICBBeGlvc01vY2tSZXF1ZXN0Q3JpdGVyaWEsXG4gICAgQXhpb3NNb2NrVHlwZSxcbiAgICBIdHRwUmVzcG9uc2UsXG59IGZyb20gXCIuL21vY2stYXhpb3MtdHlwZXNcIjtcblxuLyoqIGEgRklGTyBxdWV1ZSBvZiBwZW5kaW5nIHJlcXVlc3QgKi9cbmNvbnN0IF9wZW5kaW5nX3JlcXVlc3RzOiBBeGlvc01vY2tRdWV1ZUl0ZW1bXSA9IFtdO1xuXG5jb25zdCBfbmV3UmVxOiAoY29uZmlnPzogYW55KSA9PiBVbnJlc29sdmVkU3luY2hyb25vdXNQcm9taXNlPGFueT4gPSAoY29uZmlnOiBhbnkgPSB7fSwgYWN0dWFsQ29uZmlnOiBhbnkgPSB7fSkgPT4ge1xuICAgIGlmKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIEFsbG93IGZvciBheGlvcygnZXhhbXBsZS91cmwnWywgY29uZmlnXSlcbiAgICAgICAgYWN0dWFsQ29uZmlnLnVybCA9IGNvbmZpZztcbiAgICAgICAgY29uZmlnID0gYWN0dWFsQ29uZmlnO1xuICAgIH1cblxuICAgIGNvbnN0IG1ldGhvZDogc3RyaW5nID0gY29uZmlnLm1ldGhvZCB8fCBcImdldFwiO1xuICAgIGNvbnN0IHVybDogc3RyaW5nID0gY29uZmlnLnVybDtcbiAgICBjb25zdCBkYXRhOiBhbnkgPSBjb25maWcuZGF0YTtcbiAgICBjb25zdCBwcm9taXNlOiBVbnJlc29sdmVkU3luY2hyb25vdXNQcm9taXNlPGFueT4gPSBTeW5jaHJvbm91c1Byb21pc2UudW5yZXNvbHZlZCgpO1xuXG4gICAgaWYoY29uZmlnLmNhbmNlbFRva2VuKSB7XG4gICAgICAgIGNvbmZpZy5jYW5jZWxUb2tlbi5wcm9taXNlLnRoZW4oKGNhbmNlbDogYW55KSA9PiB7XG4gICAgICAgICAgICAvLyBjaGVjayBpZiBwcm9taXNlIGlzIHN0aWxsIHdhaXRpbmcgZm9yIGFuIGFuc3dlclxuICAgICAgICAgICAgaWYoX3BlbmRpbmdfcmVxdWVzdHMuZmluZCh4ID0+IHgucHJvbWlzZSA9PT0gcHJvbWlzZSkpIHtcbiAgICAgICAgICAgICAgICBNb2NrQXhpb3MubW9ja0Vycm9yKGNhbmNlbCwgcHJvbWlzZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBfcGVuZGluZ19yZXF1ZXN0cy5wdXNoKHtcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBkYXRhLFxuICAgICAgICBtZXRob2QsXG4gICAgICAgIHByb21pc2UsXG4gICAgICAgIHVybFxuICAgIH0pO1xuICAgIHJldHVybiBwcm9taXNlO1xufTtcblxuY29uc3QgX2hlbHBlclJlcSA9IChtZXRob2Q6IHN0cmluZywgdXJsOiBzdHJpbmcsIGRhdGE/OiBhbnksIGNvbmZpZz86IGFueSkgPT4ge1xuICAgIGNvbnN0IGNvbmYgPSBkYXRhICYmIGNvbmZpZyA/IGNvbmZpZyA6IHt9O1xuICAgIHJldHVybiBfbmV3UmVxKHtcbiAgICAgICAgLi4uY29uZixcbiAgICAgICAgZGF0YSxcbiAgICAgICAgbWV0aG9kLFxuICAgICAgICB1cmwsXG4gICAgfSk7XG59O1xuXG5jb25zdCBfaGVscGVyUmVxTm9EYXRhID0gKG1ldGhvZDogc3RyaW5nLCB1cmw6IHN0cmluZywgY29uZmlnPzogYW55KSA9PiB7XG4gICAgcmV0dXJuIF9oZWxwZXJSZXEobWV0aG9kLCB1cmwsIHt9LCBjb25maWcpXG59XG5cbmNvbnN0IE1vY2tBeGlvczogQXhpb3NNb2NrVHlwZSA9IChqZXN0LmZuKF9uZXdSZXEpIGFzIHVua25vd24pIGFzIEF4aW9zTW9ja1R5cGU7XG5cbi8vIG1vY2tpbmcgQXhpb3MgbWV0aG9kc1xuTW9ja0F4aW9zLmdldCA9IGplc3QuZm4oX2hlbHBlclJlcU5vRGF0YS5iaW5kKG51bGwsIFwiZ2V0XCIpKTtcbk1vY2tBeGlvcy5wb3N0ID0gamVzdC5mbihfaGVscGVyUmVxLmJpbmQobnVsbCwgXCJwb3N0XCIpKTtcbk1vY2tBeGlvcy5wdXQgPSBqZXN0LmZuKF9oZWxwZXJSZXEuYmluZChudWxsLCBcInB1dFwiKSk7XG5Nb2NrQXhpb3MucGF0Y2ggPSBqZXN0LmZuKF9oZWxwZXJSZXEuYmluZChudWxsLCBcInBhdGNoXCIpKTtcbk1vY2tBeGlvcy5kZWxldGUgPSBqZXN0LmZuKF9oZWxwZXJSZXFOb0RhdGEuYmluZChudWxsLCBcImRlbGV0ZVwiKSk7XG5Nb2NrQXhpb3MucmVxdWVzdCA9IGplc3QuZm4oX25ld1JlcSk7XG5Nb2NrQXhpb3MuYWxsID0gamVzdC5mbigodmFsdWVzKSA9PiBQcm9taXNlLmFsbCh2YWx1ZXMpKTtcbk1vY2tBeGlvcy5oZWFkID0gamVzdC5mbihfaGVscGVyUmVxTm9EYXRhLmJpbmQobnVsbCwgXCJoZWFkXCIpKTtcbk1vY2tBeGlvcy5vcHRpb25zID0gamVzdC5mbihfaGVscGVyUmVxTm9EYXRhLmJpbmQobnVsbCwgXCJvcHRpb25zXCIpKTtcbk1vY2tBeGlvcy5jcmVhdGUgPSBqZXN0LmZuKCgpID0+IE1vY2tBeGlvcyk7XG5cbk1vY2tBeGlvcy5pbnRlcmNlcHRvcnMgPSB7XG4gICAgcmVxdWVzdDoge1xuICAgICAgICB1c2U6IGplc3QuZm4oKSxcbiAgICAgICAgZWplY3Q6IGplc3QuZm4oKSxcbiAgICB9LFxuICAgIHJlc3BvbnNlOiB7XG4gICAgICAgIHVzZTogamVzdC5mbigpLFxuICAgICAgICBlamVjdDogamVzdC5mbigpLFxuICAgIH0sXG59O1xuXG5Nb2NrQXhpb3MuZGVmYXVsdHMgPSB7XG4gICAgaGVhZGVyczoge1xuICAgICAgICBjb21tb246IFtdLFxuICAgIH0sXG59O1xuXG5Nb2NrQXhpb3MucG9wUHJvbWlzZSA9IChwcm9taXNlPzogU3luY2hyb25vdXNQcm9taXNlPGFueT4pID0+IHtcbiAgICBpZiAocHJvbWlzZSkge1xuICAgICAgICAvLyByZW1vdmUgdGhlIHByb21pc2UgZnJvbSBwZW5kaW5nIHF1ZXVlXG4gICAgICAgIGZvciAobGV0IGl4ID0gMDsgaXggPCBfcGVuZGluZ19yZXF1ZXN0cy5sZW5ndGg7IGl4KyspIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcTogQXhpb3NNb2NrUXVldWVJdGVtID0gX3BlbmRpbmdfcmVxdWVzdHNbaXhdO1xuXG4gICAgICAgICAgICBpZiAocmVxLnByb21pc2UgPT09IHByb21pc2UpIHtcbiAgICAgICAgICAgICAgICBfcGVuZGluZ19yZXF1ZXN0cy5zcGxpY2UoaXgsIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXEucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHRha2UgdGhlIG9sZGVzdCBwcm9taXNlXG4gICAgICAgIGNvbnN0IHJlcTogQXhpb3NNb2NrUXVldWVJdGVtID0gX3BlbmRpbmdfcmVxdWVzdHMuc2hpZnQoKTtcbiAgICAgICAgcmV0dXJuIHJlcSA/IHJlcS5wcm9taXNlIDogdm9pZCAwO1xuICAgIH1cbn07XG5cbk1vY2tBeGlvcy5wb3BSZXF1ZXN0ID0gKHJlcXVlc3Q/OiBBeGlvc01vY2tRdWV1ZUl0ZW0pID0+IHtcbiAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICBjb25zdCBpeCA9IF9wZW5kaW5nX3JlcXVlc3RzLmluZGV4T2YocmVxdWVzdCk7XG4gICAgICAgIGlmIChpeCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cblxuICAgICAgICBfcGVuZGluZ19yZXF1ZXN0cy5zcGxpY2UoaXgsIDEpO1xuICAgICAgICByZXR1cm4gcmVxdWVzdDtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gX3BlbmRpbmdfcmVxdWVzdHMuc2hpZnQoKTtcbiAgICB9XG59O1xuXG4vKipcbiAqIFJlbW92ZXMgYW4gaXRlbSBmb3JtIHRoZSBxdWV1ZSwgYmFzZWQgb24gaXQncyB0eXBlXG4gKiBAcGFyYW0gcXVldWVJdGVtXG4gKi9cbmNvbnN0IHBvcFF1ZXVlSXRlbSA9IChxdWV1ZUl0ZW06IFN5bmNocm9ub3VzUHJvbWlzZTxhbnk+IHwgQXhpb3NNb2NrUXVldWVJdGVtID0gbnVsbCkgPT4ge1xuICAgIC8vIGZpcnN0IGxldCdzIHByZXRlbmQgdGhlIHBhcmFtIGlzIGEgcXVldWUgaXRlbVxuICAgIGNvbnN0IHJlcXVlc3Q6IEF4aW9zTW9ja1F1ZXVlSXRlbSA9IE1vY2tBeGlvcy5wb3BSZXF1ZXN0KFxuICAgICAgICBxdWV1ZUl0ZW0gYXMgQXhpb3NNb2NrUXVldWVJdGVtLFxuICAgICk7XG5cbiAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICAvLyBJRiB0aGUgcmVxdWVzdCB3YXMgZm91bmRcbiAgICAgICAgLy8gPiBzZXQgdGhlIHByb21pc2VcbiAgICAgICAgcmV0dXJuIHJlcXVlc3QucHJvbWlzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFTFNFIG1heWJlIHRoZSBgcXVldWVJdGVtYCBpcyBhIHByb21pc2UgKGxlZ2FjeSBtb2RlKVxuICAgICAgICByZXR1cm4gTW9ja0F4aW9zLnBvcFByb21pc2UocXVldWVJdGVtIGFzIFVucmVzb2x2ZWRTeW5jaHJvbm91c1Byb21pc2U8YW55Pik7XG4gICAgfVxufTtcblxuTW9ja0F4aW9zLm1vY2tSZXNwb25zZSA9IChcbiAgICByZXNwb25zZT86IEh0dHBSZXNwb25zZSxcbiAgICBxdWV1ZUl0ZW06IFN5bmNocm9ub3VzUHJvbWlzZTxhbnk+IHwgQXhpb3NNb2NrUXVldWVJdGVtID0gbnVsbCxcbiAgICBzaWxlbnRNb2RlOiBib29sZWFuID0gZmFsc2UsXG4pOiB2b2lkID0+IHtcbiAgICAvLyByZXBsYWNpbmcgbWlzc2luZyBkYXRhIHdpdGggZGVmYXVsdCB2YWx1ZXNcbiAgICByZXNwb25zZSA9IE9iamVjdC5hc3NpZ24oXG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbmZpZzoge30sXG4gICAgICAgICAgICBkYXRhOiB7fSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICBzdGF0dXNUZXh0OiBcIk9LXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BvbnNlLFxuICAgICk7XG5cbiAgICBjb25zdCBwcm9taXNlID0gcG9wUXVldWVJdGVtKHF1ZXVlSXRlbSk7XG5cbiAgICBpZiAoIXByb21pc2UgJiYgIXNpbGVudE1vZGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gcmVxdWVzdCB0byByZXNwb25kIHRvIVwiKTtcbiAgICB9IGVsc2UgaWYgKCFwcm9taXNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyByZXNvbHZpbmcgdGhlIFByb21pc2Ugd2l0aCB0aGUgZ2l2ZW4gcmVzcG9uc2UgZGF0YVxuICAgIHByb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XG59O1xuXG5Nb2NrQXhpb3MubW9ja1Jlc3BvbnNlRm9yID0gKFxuICAgIGNyaXRlcmlhOiBzdHJpbmcgfCBBeGlvc01vY2tSZXF1ZXN0Q3JpdGVyaWEsXG4gICAgcmVzcG9uc2U/OiBIdHRwUmVzcG9uc2UsXG4gICAgc2lsZW50TW9kZTogYm9vbGVhbiA9IGZhbHNlLFxuKTogdm9pZCA9PiB7XG4gICAgaWYgKHR5cGVvZiBjcml0ZXJpYSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjcml0ZXJpYSA9IHt1cmw6IGNyaXRlcmlhfTtcbiAgICB9XG4gICAgY29uc3QgcXVldWVJdGVtID0gTW9ja0F4aW9zLmdldFJlcU1hdGNoaW5nKGNyaXRlcmlhKTtcblxuICAgIGlmICghcXVldWVJdGVtICYmICFzaWxlbnRNb2RlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHJlcXVlc3QgdG8gcmVzcG9uZCB0byFcIik7XG4gICAgfSBlbHNlIGlmICghcXVldWVJdGVtKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBNb2NrQXhpb3MubW9ja1Jlc3BvbnNlKHJlc3BvbnNlLCBxdWV1ZUl0ZW0sIHNpbGVudE1vZGUpO1xufTtcblxuTW9ja0F4aW9zLm1vY2tFcnJvciA9IChcbiAgICBlcnJvcjogYW55ID0ge30sXG4gICAgcXVldWVJdGVtOiBTeW5jaHJvbm91c1Byb21pc2U8YW55PiB8IEF4aW9zTW9ja1F1ZXVlSXRlbSA9IG51bGwsXG4gICAgc2lsZW50TW9kZTogYm9vbGVhbiA9IGZhbHNlLFxuKSA9PiB7XG4gICAgY29uc3QgcHJvbWlzZSA9IHBvcFF1ZXVlSXRlbShxdWV1ZUl0ZW0pO1xuXG4gICAgaWYgKCFwcm9taXNlICYmICFzaWxlbnRNb2RlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHJlcXVlc3QgdG8gcmVzcG9uZCB0byFcIik7XG4gICAgfSBlbHNlIGlmICghcHJvbWlzZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gcmVzb2x2aW5nIHRoZSBQcm9taXNlIHdpdGggdGhlIGdpdmVuIHJlc3BvbnNlIGRhdGFcbiAgICBwcm9taXNlLnJlamVjdChlcnJvcik7XG59O1xuXG5Nb2NrQXhpb3MubGFzdFJlcUdldCA9ICgpID0+IHtcbiAgICByZXR1cm4gX3BlbmRpbmdfcmVxdWVzdHNbX3BlbmRpbmdfcmVxdWVzdHMubGVuZ3RoIC0gMV07XG59O1xuXG5Nb2NrQXhpb3MubGFzdFByb21pc2VHZXQgPSAoKSA9PiB7XG4gICAgY29uc3QgcmVxID0gTW9ja0F4aW9zLmxhc3RSZXFHZXQoKTtcbiAgICByZXR1cm4gcmVxID8gcmVxLnByb21pc2UgOiB2b2lkIDA7XG59O1xuXG5jb25zdCBfZmluZFJlcUJ5UHJlZGljYXRlID0gKHByZWRpY2F0ZTogKGl0ZW06IEF4aW9zTW9ja1F1ZXVlSXRlbSkgPT4gYm9vbGVhbikgPT4ge1xuICAgIHJldHVybiBfcGVuZGluZ19yZXF1ZXN0c1xuICAgIC5zbGljZSgpXG4gICAgLnJldmVyc2UoKSAvLyByZXZlcnNlIGNsb25lZCBhcnJheSB0byByZXR1cm4gbW9zdCByZWNlbnQgcmVxXG4gICAgLmZpbmQocHJlZGljYXRlKTtcbn1cblxuY29uc3QgX2NoZWNrQ3JpdGVyaWEgPSAoaXRlbTogQXhpb3NNb2NrUXVldWVJdGVtLCBjcml0ZXJpYTogQXhpb3NNb2NrUmVxdWVzdENyaXRlcmlhKSA9PiB7XG4gICAgaWYgKGNyaXRlcmlhLm1ldGhvZCAhPT0gdW5kZWZpbmVkICYmIGNyaXRlcmlhLm1ldGhvZC50b0xvd2VyQ2FzZSgpICE9PSBpdGVtLm1ldGhvZC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoY3JpdGVyaWEudXJsICE9PSB1bmRlZmluZWQgJiYgY3JpdGVyaWEudXJsICE9PSBpdGVtLnVybCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5Nb2NrQXhpb3MuZ2V0UmVxTWF0Y2hpbmcgPSAoY3JpdGVyaWE6IEF4aW9zTW9ja1JlcXVlc3RDcml0ZXJpYSkgPT4ge1xuICAgIHJldHVybiBfZmluZFJlcUJ5UHJlZGljYXRlKCh4KSA9PiBfY2hlY2tDcml0ZXJpYSh4LCBjcml0ZXJpYSkpO1xufTtcblxuTW9ja0F4aW9zLmdldFJlcUJ5VXJsID0gKHVybDogc3RyaW5nKSA9PiB7XG4gICAgcmV0dXJuIE1vY2tBeGlvcy5nZXRSZXFNYXRjaGluZyh7dXJsfSk7XG59O1xuXG5Nb2NrQXhpb3MuZ2V0UmVxQnlNYXRjaFVybCA9ICh1cmw6IFJlZ0V4cCkgPT4ge1xuICAgIHJldHVybiBfZmluZFJlcUJ5UHJlZGljYXRlKCh4KSA9PiB1cmwudGVzdCh4LnVybCkpO1xufTtcblxuTW9ja0F4aW9zLnF1ZXVlID0gKCkgPT4ge1xuICAgIHJldHVybiBfcGVuZGluZ19yZXF1ZXN0cztcbn07XG5cbk1vY2tBeGlvcy5yZXNldCA9ICgpID0+IHtcbiAgICAvLyByZW1vdmUgYWxsIHRoZSByZXF1ZXN0c1xuICAgIF9wZW5kaW5nX3JlcXVlc3RzLnNwbGljZSgwLCBfcGVuZGluZ19yZXF1ZXN0cy5sZW5ndGgpO1xuXG4gICAgLy8gcmVzZXRzIGFsbCBpbmZvcm1hdGlvbiBzdG9yZWQgaW4gdGhlIG1vY2tGbi5tb2NrLmNhbGxzIGFuZCBtb2NrRm4ubW9jay5pbnN0YW5jZXMgYXJyYXlzXG4gICAgTW9ja0F4aW9zLmdldC5tb2NrQ2xlYXIoKTtcbiAgICBNb2NrQXhpb3MucG9zdC5tb2NrQ2xlYXIoKTtcbiAgICBNb2NrQXhpb3MucHV0Lm1vY2tDbGVhcigpO1xuICAgIE1vY2tBeGlvcy5wYXRjaC5tb2NrQ2xlYXIoKTtcbiAgICBNb2NrQXhpb3MuZGVsZXRlLm1vY2tDbGVhcigpO1xuICAgIE1vY2tBeGlvcy5oZWFkLm1vY2tDbGVhcigpO1xuICAgIE1vY2tBeGlvcy5vcHRpb25zLm1vY2tDbGVhcigpO1xuICAgIE1vY2tBeGlvcy5yZXF1ZXN0Lm1vY2tDbGVhcigpO1xuICAgIE1vY2tBeGlvcy5hbGwubW9ja0NsZWFyKCk7XG59O1xuXG5Nb2NrQXhpb3MuQ2FuY2VsID0gQ2FuY2VsO1xuTW9ja0F4aW9zLkNhbmNlbFRva2VuID0gQ2FuY2VsVG9rZW47XG5Nb2NrQXhpb3MuaXNDYW5jZWwgPSAodSk6IHUgaXMgQ2FuY2VsID0+IHtcbiAgICByZXR1cm4gISEodSAmJiB1Ll9fQ0FOQ0VMX18pO1xufTtcblxuLy8gdGhpcyBpcyBhIHNpbmdsZXRvbiBvYmplY3RcbmV4cG9ydCBkZWZhdWx0IE1vY2tBeGlvcztcbiJdfQ==