name: CI

on:

  push:

    branches: [ develop ]

  pull_request:

    branches: [ develop ]

jobs:

  install-and-test:

    runs-on: ubuntu-latest

    steps: 

      - uses: actions/checkout@v2

      - name: Install npm dependencies

        run: |
          cd SoftServeCarMobile
          npm install
      - name: Run tests

        run: |
          cd SoftServeCarMobile
          npm test -- --coverage
  sonarcloud:

    runs-on: ubuntu-latest

    needs: [install-and-test]

    steps:

      - uses: actions/checkout@v2

      - name: Install npm dependencies

        run: |
          cd SoftServeCarMobile
          npm install
           npm test -- --coverage
      - name: SonarCloudScan

        uses: SonarSource/sonarcloud-github-action@v1.4

        env:

            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}  

        with:

          args: >
            -Dsonar.organization=ita-social-projects
            -Dsonar.projectKey=ita-social-projects_Car-Front-End
            -Dsonar.javascript.lcov.reportPaths=SoftServeCarMobile/coverage/lcov.info 
            -Dsonar.sources=./SoftServeCarMobile
            -Dsonar.exclusions=**/coverage/**,**/__tests__/**
            -Dsonar.verbose=false
            -Dsonar.coverage.exclusions=**/__tests__/**,**/coverage/**,**/*config.js,**/styles/**,**/ChatStyles/**
            -Dsonar.c.file.suffixes=-
            -Dsonar.cpp.file.suffixes=-
            -Dsonar.objc.file.suffixes=-
            -Dsonar.java.file.suffixes=-  
